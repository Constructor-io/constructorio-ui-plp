import { Meta, Canvas, Markdown } from '@storybook/blocks';
import * as GroupsStories from './Groups.stories';
import UseGroupsReturn from '../../hooks/UseGroups/UseGroupsReturn.md?raw';
/* This "?raw" import raw text form the md file */

<Meta of={GroupsStories} />

# `Groups`

A separate filter component that allows you to filter down by groups.

> Note: In Constructor, groups are typically categories and are created via the `item_groups.csv` feed.

**Dynamic Hierarchical Options Rendering:**

- Automatically updates and displays selected filters based on user requests
- Displays the current selected group hierarchy, and allows for backward navigation
- Automatically hides groups that are ingested with `data.cio_plp_hidden = true` (ðŸ“¦ v1.6.1 required)

<Canvas of={GroupsStories.Primary} />

## Basic example

To view the examples and see this component in action

- **Search** - append your URL with `?q=shirt`
- **Browse** - append your URL with `/group_id/1035`

```jsx
import { CioPlp, CioPlpGrid, Groups, utils } from '@constructor-io/constructorio-ui-plp';
import '@constructor-io/constructorio-ui-plp/styles.css';

const DEMO_API_KEY = 'key_M57QS8SMPdLdLx4x';

export default function MyComponent() {
  return (
    <CioPlp apiKey={DEMO_API_KEY}>
      <CioPlpGrid>
        {(props) => {
          if (utils.isPlpSearchDataResults(props.data)) {
            return <Groups groups={props.data.response.groups} />;
          }
        }}
      </CioPlpGrid>
    </CioPlp>
  );
}
```

## Configuration Options (`groupsConfigs`)

The Groups component supports various configuration options that can be passed via component props, or via the `groupsConfigs` prop at the `CioPlp`-level

### Show N Initial Options

Show only a specific number of group options initially, with remaining options hidden under a "Show All" button:

<Canvas of={GroupsStories.LimitedOptions} />

```jsx
import { CioPlp, CioPlpGrid } from '@constructor-io/constructorio-ui-plp';
import '@constructor-io/constructorio-ui-plp/styles.css';

const DEMO_API_KEY = 'key_M57QS8SMPdLdLx4x';

export default function MyComponent() {
  return (
    <CioPlp
      apiKey={DEMO_API_KEY}
      groupsConfigs={{
        initialNumOptions: 2, // Show only 2 options initially
      }}
    />
  );
}
```

### Collapsed by Default

Start with the groups section collapsed:

<Canvas of={GroupsStories.CollapsedByDefault} />

```jsx
export default function MyComponent() {
  return (
    <CioPlp
      apiKey={DEMO_API_KEY}
      groupsConfigs={{
        isCollapsed: true, // Start collapsed
      }}
    />
  );
}
```

### Custom Title

Customize the title of the groups section:

<Canvas of={GroupsStories.CustomTitle} />

```jsx
export default function MyComponent() {
  return (
    <CioPlp
      apiKey={DEMO_API_KEY}
      groupsConfigs={{
        title: 'Product Categories', // Custom title
      }}
    />
  );
}
```

### Hidden Groups

Completely hide the groups component:

```jsx
export default function MyComponent() {
  return (
    <CioPlp
      apiKey={DEMO_API_KEY}
      groupsConfigs={{
        hideGroups: true, // Hide groups entirely
      }}
    />
  );
}
```

### Direct Groups Component Configuration

You can also pass these configurations directly to the Groups component:

```jsx
import { CioPlp, CioPlpGrid, Groups, utils } from '@constructor-io/constructorio-ui-plp';
import '@constructor-io/constructorio-ui-plp/styles.css';

const DEMO_API_KEY = 'key_M57QS8SMPdLdLx4x';

export default function MyCustomComponent() {
  return (
    <CioPlp apiKey={DEMO_API_KEY}>
      <CioPlpGrid>
        {(props) => {
          if (utils.isPlpSearchDataResults(props.data)) {
            return (
              <Groups
                groups={props.data.response.groups}
                initialNumOptions={3}
                title='Product Categories'
                isCollapsed={false}
                hideGroups={false}
              />
            );
          }
        }}
      </CioPlpGrid>
    </CioPlp>
  );
}
```

### Hide Specific Groups
> ðŸ“¦ v1.6.1 is required for this feature
To hide specific groups, you can pass [groupConfigs.isHiddenGroupFn](./?path=/docs/components-groups--props) prop at the top CioPlp-level.

```jsx
import { CioPlp, CioPlpGrid } from '@constructor-io/constructorio-ui-plp';
import '@constructor-io/constructorio-ui-plp/styles.css';

const DEMO_API_KEY = 'key_M57QS8SMPdLdLx4x';

const groupConfigs = {
  isHiddenGroupFn: (group) => !!group.data.cio_plp_hidden;
}

export default function MyComponent() {
  return (
    <CioPlp apiKey={DEMO_API_KEY} groupConfigs={groupConfigs} />
  );
}
```

## Render Props pattern

To override the default rendering of the Groups component, you may pass a Render Props function to the component.

```jsx
import { CioPlp, CioPlpGrid, Groups, utils } from '@constructor-io/constructorio-ui-plp';
import '@constructor-io/constructorio-ui-plp/styles.css';

const DEMO_API_KEY = 'key_M57QS8SMPdLdLx4x';

function MyCustomGroups(props) {
  const {
    groupOptions,
    currentGroupId,
    breadcrumbs,
    currentPage,
    initialNumOptions,
    isShowAll,
    optionsToRender,
  } = props;
  return <pre>{JSON.stringify(groupOptions, null, 2)}</pre>;
}

export default function MyComponent() {
  return (
    <CioPlp apiKey={DEMO_API_KEY}>
      <CioPlpGrid>
        {(props) => {
          if (utils.isPlpSearchDataResults(props.data)) {
            return (
              <Groups groups={props.data.response.groups}>
                {(groupProps) => {
                  return <MyCustomGroups {...groupProps} />;
                }}
              </Groups>
            );
          }
        }}
      </CioPlpGrid>
    </CioPlp>
  );
}
```

### Arguments passed to children via Render Props

> Accessible to children of the Filters component via render props.

`UseGroupReturn`

<Markdown>{UseGroupsReturn}</Markdown>
