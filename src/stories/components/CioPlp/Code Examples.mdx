import { Meta, Markdown, Canvas } from '@storybook/blocks';
import * as CioPlpStories from './CioPlp.stories';
import RenderProps from './RenderProps.md?raw';
/* This "?raw" import raw text form the md file */

<Meta of={CioPlpStories} />

# `CioPlp`

The `<CioPlp/>` component is designed to simplify and enhance the way you manage and display product listings or similar content in your application.
This component offers a default layout for your PLP, while also serving as a versatile wrapper around other components, allowing for consistent context management and flexible content rendering.

**Key Features:**

- Default PLP Markup that includes: Product Grid, Filters, Sorting, Pagination
- Context Management: [Context values](./?path=/docs/components-cioplp--code-examples#arguments-passed-to-children-via-render-props) are accessible within children of CioPlp
- Identifies the current page context and renders Search or Browse accordingly

## Default Render

Open in full screen here:

- <a href='./?path=/story/components-cioplp--search-plp'>Search</a>
- <a href='./?path=/story/components-cioplp--browse-plp'>Browse</a>

<Canvas of={CioPlpStories.SearchPlp} />

## Basic Example

This renders the PLP displayed above.

To view the examples and see this component in action
  - **Search** - append your URL with `?q=shirt`
  - **Browse** - append your URL with `/group_id/1035`

```jsx
import { CioPlp } from "@constructor-io/constructorio-ui-plp";
import "@constructor-io/constructorio-ui-plp/styles.css";

const DEMO_API_KEY = "key_M57QS8SMPdLdLx4x";

export default function MyComponent() {
  return <CioPlp apiKey={DEMO_API_KEY} />;
}
```

For a working example, visit our Code Sandbox:

- <a href='https://codesandbox.io/p/sandbox/constructorio-ui-plp-example-fpz8sz' target='_blank' rel='noopener noreferrer'> Code Sandbox Example <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-right-icon lucide-arrow-up-right"><path d="M7 7h10v10"/><path d="M7 17 17 7"/></svg></a>

## Configuration Options

The CioPlp component supports various configuration options to customize the behavior of its child components.

### Groups Configuration (`groupsConfigs`)

Configure how product categories/groups are displayed and behave. For detailed examples and interactive demos, see the <a href='./?path=/docs/components-groups--code-examples'>Groups component documentation</a>.

### All Configuration Options

```jsx
export default function MyComponent() {
  return (
    <CioPlp
      apiKey={DEMO_API_KEY}
      // Groups configuration
      groupsConfigs={{
        initialNumOptions: 4,        // Number of options to show initially
        isCollapsed: false,          // Whether groups start collapsed
        title: 'Shop by Category',   // Custom title
        hideGroups: false,           // Whether to hide groups entirely
        isHiddenGroupFn: (group) => false, // Function that returns true if a particular group should not be rendered
      }}
      // Pagination configuration
      paginationConfigs={{
        windowSize: 5,              // Number of page buttons to show
      }}
      // Sort and filter configs (no specific options yet)
      sortConfigs={{}}
      filterConfigs={{}}
    />
  );
}
```

## Render Props pattern

Take control of the rendering logic by using Render Props through `children`.
The [context](..?path=/docs/components-cioplp--code-examples#cioplp-context-value) will be passed along as props to your render function.

```jsx
import { CioPlp } from "@constructor-io/constructorio-ui-plp";
import "@constructor-io/constructorio-ui-plp/styles.css";

const DEMO_API_KEY = "key_M57QS8SMPdLdLx4x";

function MyCustomPlp(props) {
  const {
    cioClient,
    cioClientOptions,
    setCioClientOptions,
    formatters,
    itemFieldGetters,
    urlHelpers,
    callbacks,
  } = props;

  return <>{/* CUSTOM_MARKUP_HERE */}</>;
}

export default function MyComponent() {
  return (
    <CioPlp apiKey={DEMO_API_KEY}>
      {(props) => {
        return <MyCustomPlp {...props} />;
      }}
    </CioPlp>
  );
}
```

For a working example, visit our Code Sandbox:

- <a href='https://codesandbox.io/p/sandbox/constructorio-ui-plp-customization-example-sgdgkl?file=%2Fsrc%2Fcomponents%2FCustomCioPlp.js' target='_blank' rel='noopener noreferrer'> Code Sandbox Example - Custom Render <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-right-icon lucide-arrow-up-right"><path d="M7 7h10v10"/><path d="M7 17 17 7"/></svg></a>

### Arguments passed to children via Render Props

> Accessible to children of the CioPlp component via render props.
> or via useCioPlpContext() hook.

<Markdown>{RenderProps}</Markdown>


## Overriding Product Card using Vanilla JS 
> **ðŸ“¦ v1.6.0 or higher is required for this feature**

If you're importing the library via the [bundle approach](https://github.com/Constructor-io/constructorio-ui-plp?tab=readme-ov-file#using-the-javascript-bundle) 
and are unable to pass JSX, you may pass a custom render function at the top level instead. This function will receive the same render props as 
listed in [Product Card](./?path=/docs/components-productcard--code-examples#arguments-passed-to-children-via-render-props), 
and should return a `HTMLElement`.


```html
<div id="plp"></div>

<!-- Load the bundled plp-ui -->
<script type="module" src="https://cdn.cnstrc.com/ui/plp/1.4.7.js"></script>

<script type="module">
  // Define your custom render function
  const renderCustomProductCard = ({ item, productInfo, onAddToCart }) => {
    // Parent container
    const productCardContainer = document.createElement('div');
    const clickableElement = document.createElement('a');
    clickableElement.href = productInfo.itemUrl;

    // Images
    const imgContainer = document.createElement('div');
    const img = document.createElement('img');
    imgContainer.classList.add('cio-image-container');
    img.src = productInfo.itemImageUrl;
    img.alt = productInfo.itemName;
    img.classList.add('cio-image-container');
    imgContainer.appendChild(img);

    // Content Section
    const content = document.createElement('div');

    const priceContainer = document.createElement('div');
    const price = document.createElement('div');
    content.classList.add('cio-content');
    priceContainer.classList.add('cio-item-prices-container');
    price.classList.add('cio-item-price');
    price.id = 'cio-sale-price';
    price.textContent = String(productInfo.itemPrice);
    priceContainer.appendChild(price);

    const itemName = document.createElement('div');
    itemName.textContent = productInfo.itemName;
    itemName.classList.add('cio-item-name');

    content.appendChild(priceContainer);
    content.appendChild(itemName);

    // CTA
    const button = document.createElement('button');
    button.textContent = 'Add to Cart';
    button.type = 'button';
    button.onclick = (e) => console.log(e);
    button.classList.add('cio-add-to-cart-button');

    clickableElement.appendChild(imgContainer);
    clickableElement.appendChild(content);
    productCardContainer.appendChild(clickableElement);
    productCardContainer.appendChild(button);

    return productCardContainer;
  };

  // Initialize the PLP OS UI
  CioPlp({
    selector: '#plp',
    includeCSS: true, // Include the default CSS styles. Defaults to true.
    apiKey: 'key_M57QS8SMPdLdLx4x',
    renderOverrides: {
      productCard: {
        renderHtml: renderCustomProductCard,
      },
    },
  });
</script>
```
